(()=>{"use strict";let e=JSON.parse(localStorage.getItem("lastClickedLatLon"))||[55.752318,37.619814],t=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),o=L.tileLayer("http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),n=L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"}),a=L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}),l=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),i=L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}{r}.{ext}",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png"}),r=L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner-background/{z}/{x}/{y}{r}.{ext}",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png"}),c=L.tileLayer("https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.png",{maxZoom:20,attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),s=L.tileLayer("https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png",{maxZoom:20,attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),d=L.tileLayer("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}{r}.png",{attribution:'<a href="https://wikimediafoundation.org/wiki/Maps_Terms_of_Use">Wikimedia</a>'}),p=L.map("map",{center:e,maxZoom:18,zoom:10,layers:[t]}),u={OpenStreetMap:t,"OpenStreetMap Black And White":o,"CartoDB.Positron":a,"CartoDB.Voyager":n,"Esri.WorldImagery":l,"Stamen.Toner":i,"Stamen.TonerBackground":r,"Stadia.OSMBright":c,"Stadia.AlidadeSmooth":s,Wikimedia:d};L.control.layers(u,null,{position:"bottomright"}).addTo(p),L.control.scale().addTo(p),p.on("click",(e=>{localStorage.setItem("lastClickedLatLon",JSON.stringify([e.latlng.lat,e.latlng.lng]))}));const m=L.Control.extend({onAdd:e=>{const t=L.DomUtil.create("div");return L.DomEvent.disableClickPropagation(t),t.innerHTML='<div class="user-location-control"><span class="mdi mdi-near-me mdi-18px" title="My location"></span></div>',t}});p.addControl(new m({position:"topleft"}));const y=document.querySelector(".user-location-control"),g=y.getElementsByTagName("SPAN")[0];y.addEventListener("click",(function(){f()}));const f=()=>{g.classList.remove("mdi-near-me"),g.classList.add("mdi-loading","mdi-spin");let e=[];navigator.geolocation.getCurrentPosition((function(t){e=[t.coords.latitude,t.coords.longitude,t.coords.accuracy],p.setView([e[0],e[1]],10);let o=manageObjects.add("circle",[e[0],e[1],e[2]]);manageObjects.locateByObjectID(o),g.classList.remove("mdi-loading","mdi-spin"),g.classList.add("mdi-near-me")}),(function(e){console.warn(`ERROR(${e.code}): ${e.message}`),g.classList.remove("mdi-loading","mdi-spin"),g.classList.add("mdi-near-me"),modalBackground.open()}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})};let h=!0;const b=(e,t)=>{navigator.clipboard.writeText(e).then((function(){A({type:"clipboardCopyResult",text:`JSON data of <strong>${t}</strong> copied to clipboard successfully!`}),x.close(),x.open()}),(function(){A({type:"clipboardCopyResult",text:`JSON data of <strong>${t}</strong> copying to clipboard failed!`}),x.close(),x.open()}))},v=e=>void 0===e?"—":e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),k=e=>e>1e4?{value:(e/1e3).toFixed(2),unit:"km"}:{value:e.toFixed(0),unit:"m"},S=e=>!isNaN(e)&&""!==e&&Math.abs(e)<=90,w=e=>!isNaN(e)&&""!==e&&Math.abs(e)<=180;function M(e,t,o=1,n=1,a,l,i=0,r=0,c=0){return`<div class="popup-row"><div class="popup-col-1">ID:</div><div class="popup-col-2">${e}</div></div><div class="popup-row"><div class="popup-col-1">Type:</div><div class="popup-col-2">${t}</div></div><div class="popup-row"><div class="popup-col-1">Points:</div><div class="popup-col-2">${o} / ${n}</div></div><div class="popup-row"><div class="popup-col-1">Lat, Lon:</div><div class="popup-col-2"><strong>${a}, ${l}</strong></div></div>${0!==i?`<div class="popup-row"><div class="popup-col-1">Radius:</div><div class="popup-col-2">${i}</div></div>`:""}`}window.mdc.autoInit();let T=new mdc.switchControl.MDCSwitch(document.getElementById("b-marker-switch"));T.checked=!0,T.listen("change",(function(e){var t;t=e.target.checked,h=t}));let x=new mdc.snackbar.MDCSnackbar(document.getElementById("b-mdc-snackbar")),C=document.getElementById("b-mdc-snackbar-content");x.timeoutMs=7500;const A=e=>{"addArray"===e.type?C.innerHTML=`Added <strong>${e.payload.points}</strong> point(s), <strong>${e.payload.circles}</strong> circle(s), <strong>${e.payload.polylines}</strong> polyline(s) and <strong>${e.payload.polygones}</strong> polygone(s).<br>Skipped <strong>${e.payload.skipped}</strong> element(s).`:"clipboardCopyResult"===e.type&&(C.innerHTML=e.text)};let E=new mdc.tabBar.MDCTabBar(document.querySelector(".mdc-tab-bar")),O=document.querySelectorAll(".mdc-tab-content"),P=["point","circle","line","array"],j="point",B=document.getElementById("hint-about-tabs");E.listen("MDCTabBar:activated",(function(e){var t;j=P[e.detail.index],document.querySelector(".mdc-tab-content--active").classList.remove("mdc-tab-content--active"),O[e.detail.index].classList.add("mdc-tab-content--active"),history.pushState("","","?tab="+j),B.innerHTML="point"===(t=j)?"<p>You can add point by holding down the <kbd>shift</kbd> key while left-clicking on the map.</p><p>Click once to add one point.</p>":"circle"===t?"<p>You can add circle by holding down the <kbd>shift</kbd> key while left-clicking on the map.</p><p>Click twice — first time to add center point and second for circle edge.</p>":"line"===t?"<p>You can add line, polyline or polygon by holding down the <kbd>shift</kbd> key while left-clicking on the map.</p><p>Click on any temp marker to finish. If you click first marker at last it will be polygon, otherwise it will be polyline.</p>":"array"===t?'<p>Array of objects: <code>[{obj_1}, {obj_2}, ..., {obj_n}]</code>.<a href="https://github.com/bazhanius/simple-geo-tool/#add-array-of-coordinates-via-text-field">Learn more</a>.</p>':""}));const N=()=>j;let _=new URLSearchParams(location.search),$=_.get("tab"),I=_.get("addArray");if("point"===$)E.activateTab(0),j="point";else if("circle"===$)E.activateTab(1),j="circle";else if("line"===$)E.activateTab(2),j="line";else if("array"===$){if(E.activateTab(3),j="array",I&&dF.isJSON(I)){let e=manageObjects.addArray(I);e.payload.points+e.payload.circles+e.payload.polylines+e.payload.polygones>0&&manageObjects.showAll(),A(e),x.close(),x.open()}}else history.pushState({},null,location.href.split("?")[0]);const q=document.querySelector("#b-mdc-modal-window"),D=new mdc.dialog.MDCDialog(q);q.querySelector("#dialog-confirm").onclick=function(){dF.openInNewTab("https://yandex.com/support/common/browsers-settings/"),D.close()},q.querySelector("#dialog-cancel").onclick=function(){D.close()};let z=[];function F(e,t,o){let n=[],a=null;function l(){let t=n.shift();t&&e.apply(t.context,t.arguments),0===n.length&&(clearInterval(a),a=null)}return function(){n.push({context:o||this,arguments:[].slice.call(arguments)}),a||(a=setInterval(l,t))}}let H=F((function(e,t){z.filter((t=>t.lat===e)).find((e=>e.lon===t))||fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${e}&lon=${t}`).then((function(e){return e.json()})).then((function(o){let n={lat:e,lon:t,address:o.display_name};z.push(n)}))}),1100),R=F((function(e,t){let o=t.findIndex((t=>t.id===e));o>=0&&t[o].leaflet_object.getLayers().filter((e=>e instanceof L.Marker)).forEach((e=>{let t=e.options.latLon[0],o=e.options.latLon[1],n=z.filter((e=>e.lat===t)).find((e=>e.lon===o)).address;if(n){let t=e.getPopup().getContent(),o=`<div class="popup-row"><div class="popup-col-1">Address:</div><div class="popup-col-2"><small>${n}</small></div></div>`;e.getPopup().setContent(t+o)}}))}),5500);const U=function(){let e=document.querySelector("#point-lat"),t=document.querySelector("#point-lon"),o=document.querySelector("#circle-lat"),n=document.querySelector("#circle-lon"),a=document.querySelector("#circle-radius"),l=document.querySelector("#line-lat-1"),i=document.querySelector("#line-lon-1"),r=document.querySelector("#line-lat-2"),c=document.querySelector("#line-lon-2"),s=document.querySelector("#array-of-coordinates");return{getNodeList:function(d){return"point"===d?[e,t]:"circle"===d?[o,n,a]:"line"===d?[l,i,r,c]:"array"===d?[s]:[]},getValues:function(d){return"point"===d?{lat:e.value,lon:t.value}:"circle"===d?{lat:o.value,lon:n.value,rad:a.value}:"line"===d?{latOne:l.value,lonOne:i.value,latTwo:r.value,lonTwo:c.value}:"array"===d?{arrayList:s.value}:{}},clearValues:function(d){"point"===d?(e.value="",t.value=""):"circle"===d?(o.value="",n.value="",a.value=""):"line"===d?(l.value="",i.value="",r.value="",c.value=""):"array"===d&&(s.value="")},validateValues:function(e){if("point"===e){let e=[0,0,0],t=U.getValues("point");return S(t.lat)?e[0]=1:e[0]=0,w(t.lon)?e[1]=1:e[1]=0,t.lat||t.lon?e[2]=1:e[2]=0,e}if("circle"===e){let e=[0,0,0,0],t=U.getValues("circle");return S(t.lat)?e[0]=1:e[0]=0,w(t.lon)?e[1]=1:e[1]=0,t.rad&&!isNaN(t.rad)&&t.rad>0&&t.rad<=1e6?e[2]=1:e[2]=0,t.lat||t.lon||t.rad?e[3]=1:e[3]=0,e}if("line"===e){let e=[0,0,0,0,0],t=U.getValues("line");return S(t.latOne)?e[0]=1:e[0]=0,w(t.lonOne)?e[1]=1:e[1]=0,S(t.latTwo)?e[2]=1:e[2]=0,w(t.lonTwo)?e[3]=1:e[3]=0,t.latOne||t.lonOne||t.latTwo||t.lonTwo?e[4]=1:e[4]=0,e}if("array"===e){let e=[0,0,0],t=U.getValues("array"),o=new RegExp(/^[0-9a-z\ \s*\.\,\-\[\]\{\}\"\:]*$/i);return t.arrayList&&o.test(t.arrayList)?e[0]=1:e[0]=0,t.arrayList?e[1]=1:e[1]=0,(e=>{if(e.length<5||!e.startsWith("["))return!1;try{return JSON.parse(e)}catch(e){return!1}})(t.arrayList)?e[2]=1:e[2]=0,e}return[]}}}();U.getNodeList("point").forEach((function(e){e.addEventListener("keyup",(function(){G.toggleAddToMapButtons("point")}))})),U.getNodeList("circle").forEach((function(e){e.addEventListener("keyup",(function(){G.toggleAddToMapButtons("circle")}))})),U.getNodeList("line").forEach((function(e){e.addEventListener("keyup",(function(){G.toggleAddToMapButtons("line")}))})),U.getNodeList("array").forEach((function(e){e.addEventListener("keyup",(function(){G.toggleAddToMapButtons("array")}))}));const G=function(){let e=document.querySelector("#button-add-to-map"),t=document.querySelector("#button-clear-fields"),o=document.querySelector("#button-objects-copy-all"),n=document.querySelector("#button-objects-zoom-all"),a=document.querySelector("#button-objects-delete-all");return{applyClickEvents:function(){e.addEventListener("click",(function(){let e,t,o=N(),n=U.getValues(o);"point"===o?e=ce.add({type:"point",coords:[{lat:n.lat,lon:n.lon}]}):"circle"===o?e=ce.add({type:"circle",coords:[{lat:n.lat,lon:n.lon}],radius:n.rad}):"line"===o?e=ce.add({type:"polyline",coords:[{lat:n.latOne,lon:n.lonOne},{lat:n.latTwo,lon:n.lonTwo}]}):"array"===o&&(t=ce.addArray(n.arrayList)),"array"!==o?ce.locateByObjectID(e):(t.payload.points+t.payload.circles+t.payload.polylines+t.payload.polygones>0&&ce.showAll(),A(t),x.close(),x.open())})),t.addEventListener("click",(function(){let e=N();U.clearValues(e),G.toggleAddToMapButtons(e)})),o.addEventListener("click",(function(){ce.copyAllToClipboard()})),n.addEventListener("click",(function(){ce.showAll()})),a.addEventListener("click",(function(){ce.deleteAll()}))},updateObjectsManagementButtons:function(){let e=document.querySelectorAll(".button-object-copy"),t=document.querySelectorAll(".button-object-locate"),o=document.querySelectorAll(".button-object-delete");e.forEach((function(e){e.addEventListener("click",(function(){ce.copyToClipboardByNode(this)}))})),t.forEach((function(e){e.addEventListener("click",(function(){ce.locateByNode(this)}))})),o.forEach((function(e){e.addEventListener("click",(function(){ce.delete(this),G.toggleObjectListButton()}))}))},toggleAddToMapButtons:function(o){let n=U.validateValues(o);e.disabled=n.indexOf(0)>-1,t.disabled=n.indexOf(1)<=-1},toggleObjectListButton:function(){let e=document.querySelector("#objects-list");ie.length>0?(o.disabled=!1,n.disabled=!1,a.disabled=!1,e.style.visibility="visible"):(o.disabled=!0,n.disabled=!0,a.disabled=!0,e.style.visibility="hidden")}}}(),V=L.Control.extend({onAdd:e=>{const t=L.DomUtil.create("div");return L.DomEvent.disableClickPropagation(t),t.innerHTML='<div class="ruler-control"><div class="ruler-control-polyline mdi mdi-ruler mdi-18px" title="Ruler"></div></div>',t}});p.addControl(new V({position:"topleft"})),p.createPane("rulerLinesPane"),p.getPane("rulerLinesPane").style.zIndex=650,p.createPane("rulerMarkersPane"),p.getPane("rulerMarkersPane").style.zIndex=651;const J=document.querySelector(".ruler-control-polyline");let Z=!1,W=(new L.featureGroup).addTo(p),Y=[],K=null;const X=()=>{W.addLayer(L.polyline([],{className:"ruler-polyline-path-bg",pane:"rulerLinesPane"}).addTo(p)),W.addLayer(L.polyline([],{className:"ruler-polyline-path",pane:"rulerLinesPane"}).addTo(p))};function Q(){W.eachLayer((function(e){e instanceof L.Marker&&e.closePopup()}))}function ee(){oe()}function te(){oe(),ae(K._leaflet_id)}X(),J.addEventListener("click",(function(){!1===Z?(J.classList.add("ruler-control__active"),L.DomUtil.addClass(p._container,"crosshair-cursor-enabled"),Z=!0,ce.disableAllPopups()):(J.classList.remove("ruler-control__active"),L.DomUtil.removeClass(p._container,"crosshair-cursor-enabled"),Z=!1,W.clearLayers(),X(),Y=[],ce.enableAllPopups())}));const oe=(e,t)=>{if(e&&t){let o=L.divIcon({className:"marker-icon-pin",html:"<div class='ruler-marker-pin'></div>",iconSize:[15,15],iconAnchor:[0,0]}),n=L.marker([e,t],{icon:o,draggable:!0,pane:"rulerMarkersPane"}).on("dragstart",Q).on("drag",ee).on("dragend",te).on("popupopen",(e=>{ae(e.popup._source._leaflet_id)})).addTo(p);W.addLayer(n)}Y=(e=>{let t=[];return e.eachLayer((function(e){e instanceof L.Marker&&t.push(e.getLatLng())})),[t]})(W),W.eachLayer((function(e){e instanceof L.Polyline&&e.setLatLngs(Y)})),ne()},ne=()=>{let e=0,t=null;W.eachLayer((function(o){if(o instanceof L.Marker){let n=o.getLatLng();t&&(e+=t.distanceTo(n)),t=n;let a=function(e,t){let o=k(e);return`<strong>${v(o.value)} ${o.unit}</strong><span id="ruler-id-${t}" class="mdi mdi-icon-button mdi-delete-forever mdi-12px"></span>`}(e,o._leaflet_id),l=o.getPopup();l?l.setContent(a):o.bindPopup(a,{className:"ruler-marker-pin-popup",offset:[0,-12],minWidth:20,closeButton:!1,autoClose:!1}).addTo(p),K=o}})),K&&K.openPopup()},ae=e=>{let t=document.querySelector("#ruler-id-"+e);t&&t.addEventListener("click",(function(){W.removeLayer(e),oe()}))};p.on("click",(function(e){Z&&!ve&&oe(e.latlng.lat,e.latlng.lng)}));let le=0,ie=[],re=document.querySelector("#objects-list > tbody");const ce={add:function(e){let t=e.type,o=e.coords,n=e.radius?e.radius:null,a="";if(t&&o){le++;let l,i=[],r=L.divIcon({className:"marker-icon-pin",html:"<div class='marker-pin marker-"+t+"-color'></div><b>"+le+"</b>",iconSize:[30,42],iconAnchor:[15,42]}),c=L.divIcon({className:"marker-icon-dot marker-"+t+"-color",iconSize:[4,4],iconAnchor:[3,3]});if("point"===t){let e=o[0].lat,t=o[0].lon;i.push(L.marker([e,t],{id:le,points:[1,1],latLon:[e,t],icon:c}).bindPopup(M(le,"Point",1,1,e,t))),h&&i.push(L.marker([e,t],{id:le,points:[1,1],latLon:[e,t],icon:r}).bindPopup(M(le,"Point",1,1,e,t))),H(e,t)}if("circle"===t){a=n;let e=o[0].lat,t=o[0].lon;i.push(L.circle([e,t],{radius:n,weight:2}),L.marker([e,t],{id:le,points:[1,1],latLon:[e,t],radius:n,icon:c}).bindPopup(M(le,"Circle",1,1,e,t,a))),h&&i.push(L.marker([e,t],{id:le,points:[1,1],latLon:[e,t],radius:n,icon:r}).bindPopup(M(le,"Circle",1,1,e,t,a))),H(e,t)}if("polyline"===t){let e=o.length,t=[];o.forEach(((o,n)=>{let a=o.lat,l=o.lon;t.push([a,l]),i.push(L.marker([a,l],{id:le,points:[n+1,e],latLon:[a,l],icon:c}).bindPopup(M(le,"Polyline",n+1,e,a,l))),h&&i.push(L.marker([a,l],{id:le,points:[n+1,e],latLon:[a,l],icon:r}).bindPopup(M(le,"Polyline",n+1,e,a,l))),H(a,l)})),a=((e,t)=>{let o={m:0,km:0},n=null;return e.forEach(((e,t)=>{let a=e[0],l=e[1];n&&(o.m+=L.latLng(n).distanceTo([a,l])),n=[a,l]})),o.km=Math.round(o.m/1e3*100)/100,o.m=Math.round(100*o.m)/100,t in o?o[t]:o})(t),i.push(L.polyline(t,{color:"#f33",weight:2}))}if("polygon"===t){let e=o.length,t=[];o.forEach(((o,n)=>{let a=o.lat,l=o.lon;t.push([a,l]),i.push(L.marker([a,l],{id:le,points:[n+1,e],latLon:[a,l],icon:c}).bindPopup(M(le,"Polygon",n+1,e,a,l))),h&&i.push(L.marker([a,l],{id:le,points:[n+1,e],latLon:[a,l],icon:r}).bindPopup(M(le,"Polygon",n+1,e,a,l))),H(a,l)})),a=((e,t)=>{let o=e.length,n={m2:0,km2:0,ft2:0,mi2:0,ac:0},a=o-1;for(let t=0;t<o;t++){let o=111319.5*e[a][0],l=111319.5*e[t][0],i=e[a][1]*(40075e3*Math.cos(e[a][0]*Math.PI/180)/360),r=e[t][1]*(40075e3*Math.cos(e[t][0]*Math.PI/180)/360);n.m2=n.m2+(o+l)*(i-r),a=t}return n.m2=Math.round(100*Math.abs(n.m2/2))/100,n.km2=Math.round(n.m2/1e6*100)/100,n.ft2=Math.round(10.76391*n.m2*100)/100,n.mi2=Math.round(3.8610216e-7*n.m2*100)/100,n.ac=Math.round(24711e-8*n.m2*100)/100,t in n?n[t]:n})(t),i.push(L.polygon(t,{color:"#080",weight:2}))}l=new L.featureGroup(i).addTo(p),re.innerHTML+=function(e,t,o){let n="";if("circle"===t){let e=k(parseFloat(o));n=`≈ ${v(e.value)} ${e.unit}`}if("polyline"===t){let e=k(o.m);n=`≈ ${v(e.value)} ${e.unit}`}return"polygon"===t&&(n=o.m2>1e4?`≈ ${v(o.km2)} km<sup>2</sup>`:`≈ ${v(o.m2)} m<sup>2</sup>`),`<tr><td>${e}</td><td>${t}</td><td>${n}</td><td><button class="mdc-button button-object-copy" title="Copy JSON to clipboard"><span class="mdc-button__ripple"></span><span class="mdi mdi-icon-button mdi-content-copy mdi-18px"></span></button><button class="mdc-button button-object-locate" title="Locate on the map"><span class="mdc-button__ripple"></span><span class="mdi mdi-icon-button mdi-crosshairs-gps mdi-18px"></span></button><button class="mdc-button button-object-delete"  title="Delete object"><span class="mdc-button__ripple"></span><span class="mdi mdi-icon-button mdi-delete-forever mdi-18px"></span></button></td></tr>`}(le,t,a);let s={id:le,type:t,object:e,leaflet_object:l,measurements:a};ie.push(s),G.updateObjectsManagementButtons(),G.toggleObjectListButton(),R(le,ie),Z&&ce.disableAllPopups()}return le},addArray:function(e){let t={type:"addArray",payload:{points:0,circles:0,polylines:0,polygones:0,skipped:0}};return JSON.parse(e).forEach(((e,o)=>{e.type&&e.coords?ce.add(e)>0?"point"===e.type?t.payload.points+=1:"circle"===e.type?t.payload.circles+=1:"polyline"===e.type?t.payload.polylines+=1:"polygon"===e.type&&(t.payload.polygones+=1):t.payload.skipped+=1:t.skipped+=1})),t},delete:function(e){let t=e.parentNode.parentNode,o=parseInt(t.firstChild.textContent),n=ie.findIndex((e=>e.id===o));ie[n].leaflet_object.clearLayers(),ie.splice(n,1),t.remove()},copyAllToClipboard:function(){let e=[];ie.forEach((function(t){e.push(t.object)})),b(JSON.stringify(e),"all objects")},copyToClipboardByNode:function(e){let t=e.parentNode.parentNode,o=parseInt(t.firstChild.textContent),n=ie.findIndex((e=>e.id===o));b("["+JSON.stringify(ie[n].object)+"]",ie[n].type)},locateByNode:function(e){let t=e.parentNode.parentNode,o=parseInt(t.firstChild.textContent),n=ie.findIndex((e=>e.id===o));p.flyToBounds(ie[n].leaflet_object.getBounds(),{padding:L.point(100,100)})},locateByObjectID:function(e){let t=ie.findIndex((t=>t.id===e));"point"===ie[t].type?p.flyToBounds(ie[t].leaflet_object.getBounds(),{maxZoom:12}):p.flyToBounds(ie[t].leaflet_object.getBounds(),{padding:L.point(100,100)})},deleteAll:function(){ie.forEach((function(e){e.leaflet_object.clearLayers()})),ie=[],re.innerHTML="",G.toggleObjectListButton()},showAll:function(){let e=[];if(ie.forEach((function(t){e.push(t.leaflet_object)})),e.length){let t=new L.featureGroup(e);p.flyToBounds(t.getBounds(),{padding:L.point(30,30)})}},disableAllPopups:function(){ie.forEach((function(e){e.leaflet_object.eachLayer((function(e){e instanceof L.Marker&&e.off("click")}))}))},enableAllPopups:function(){ie.forEach((function(e){e.leaflet_object.eachLayer((function(e){e instanceof L.Marker&&e.on("click",(function(){e.getPopup()&&e.openPopup()}))}))}))}};document.querySelectorAll(".mdc-tab").forEach((function(e){e.addEventListener("click",(function(){let e=this.getAttribute("data-tab-name");G.toggleAddToMapButtons(e),fe=[],he.clearLayers(),ue&&(ue.remove(),ue=void 0),me&&(me.remove(),me=void 0),de&&(de.remove(),de=void 0),pe&&(pe.remove(),pe=void 0)}))}));const se=L.Control.extend({onAdd:e=>{const t=L.DomUtil.create("div");return t.innerHTML='<div class="mouse-cursor-helper"><p id="mouse-coordinates">0, 0</p><p id="temp-object-summary"></p></div>',t}});p.addControl(new se({position:"topright"}));let de,pe,ue,me,ye=document.querySelector("#mouse-coordinates"),ge=document.querySelector("#temp-object-summary"),fe=[],he=(new L.featureGroup).addTo(p),be=L.divIcon({className:"marker-icon-pin",html:"<div class='marker-pin marker-point-temp-color'></div><b>+</b>",iconSize:[30,42],iconAnchor:[15,42]}),Le=L.divIcon({className:"marker-icon-dot marker-point-temp-color",iconSize:[4,4],iconAnchor:[3,3]}),ve=!1;function ke(e){ve=e.shiftKey,ve?L.DomUtil.addClass(p._container,"crosshair-cursor-enabled"):L.DomUtil.removeClass(p._container,"crosshair-cursor-enabled")}window.addEventListener("keydown",ke,!1),window.addEventListener("keypress",ke,!1),window.addEventListener("keyup",ke,!1);const Se=e=>{let t=fe[0].lat===e[0]&&fe[0].lon===e[1]&&fe.length>2?"polygon":"polyline";ce.add({type:t,coords:fe}),he.clearLayers(),fe=[],de.remove(),pe.remove(),me.remove(),me=void 0};p.on("click",(function(e){if(ve&&"array"!==j){let t=N();if(fe.push({lat:parseFloat(e.latlng.lat).toFixed(6),lon:parseFloat(e.latlng.lng).toFixed(6)}),"point"===t&&ve&&(ce.add({type:"point",coords:fe}),fe=[]),"circle"===t&&ve&&(1===fe.length?(ue=L.circle([fe[0].lat,fe[0].lon],{radius:0,weight:2,color:"#ff3",opacity:.8,fillOpacity:.1}).addTo(p),he.addLayer(L.marker([fe[0].lat,fe[0].lon],{icon:be})),he.addLayer(L.marker([fe[0].lat,fe[0].lon],{icon:Le}))):fe.length>=2&&(ce.add({type:"circle",radius:parseFloat(L.latLng([fe[0].lat,fe[0].lon]).distanceTo([fe[1].lat,fe[1].lon])).toFixed(0),coords:fe.splice(0,1)}),he.clearLayers(),fe=[],ue.remove())),"line"===t&&ve){let e=fe.length-1;me?me.setLatLngs(fe):me=L.polyline(fe,{color:"#ff3",weight:2,opacity:.6}).addTo(p),he.addLayer(L.marker([fe[e].lat,fe[e].lon],{icon:be}).on("click",(()=>{Se([fe[e].lat,fe[e].lon])}))),he.addLayer(L.marker([fe[e].lat,fe[e].lon],{icon:Le}).on("click",(t=>{Se([fe[e].lat,fe[e].lon])}))),de?de.setLatLng([fe[e].lat,fe[e].lon]):de=L.marker([fe[e].lat,fe[e].lon],{icon:be}).addTo(p),pe?pe.setLatLng([fe[e].lat,fe[e].lon]):pe=L.marker([fe[e].lat,fe[e].lon],{icon:Le}).addTo(p)}}})),p.on("mousemove",(e=>{let t=parseFloat(e.latlng.lat).toFixed(6),o=parseFloat(e.latlng.lng).toFixed(6);if(!fe[0]&&ve&&me&&"array"!==j&&(de.setLatLng([t,o]),pe.setLatLng([t,o])),fe[0]){let e=L.latLng([fe[0].lat,fe[0].lon]).distanceTo([t,o]).toFixed(0);ye.innerHTML=`<span class="mdi mdi-map-marker mdi-12px"></span> ${fe[0].lat}, ${fe[0].lon}`,ge.innerHTML=`<span class="mdi mdi-crosshairs mdi-12px"></span> ${t}, ${o}`,ge.innerHTML+=`<br>${v(e)} m`,ue&&ue.setRadius(e),me&&(de.setLatLng([t,o]),pe.setLatLng([t,o]),me.setLatLngs(fe.concat({lat:t,lon:o})))}else ye.innerHTML=`<span class="mdi mdi-crosshairs mdi-12px"></span> ${t}, ${o}`,ge.innerHTML=""})),document.addEventListener("DOMContentLoaded",(function(){G.applyClickEvents(),G.toggleAddToMapButtons(N()),G.toggleObjectListButton()}))})();