(()=>{"use strict";let t=JSON.parse(localStorage.getItem("lastClickedLatLon"))||[55.752318,37.619814],e=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),o=L.tileLayer("http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),n=L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"}),a=L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}),l=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),r=L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}{r}.{ext}",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png"}),i=L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner-background/{z}/{x}/{y}{r}.{ext}",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png"}),c=L.tileLayer("https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.png",{maxZoom:20,attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),s=L.tileLayer("https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png",{maxZoom:20,attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),d=L.tileLayer("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}{r}.png",{attribution:'<a href="https://wikimediafoundation.org/wiki/Maps_Terms_of_Use">Wikimedia</a>'}),p=L.map("map",{center:t,maxZoom:18,zoom:10,layers:[e]}),u={OpenStreetMap:e,"OpenStreetMap Black And White":o,"CartoDB.Positron":a,"CartoDB.Voyager":n,"Esri.WorldImagery":l,"Stamen.Toner":r,"Stamen.TonerBackground":i,"Stadia.OSMBright":c,"Stadia.AlidadeSmooth":s,Wikimedia:d};L.control.layers(u,null,{position:"bottomright"}).addTo(p),L.control.scale().addTo(p),p.on("click",(t=>{localStorage.setItem("lastClickedLatLon",JSON.stringify([t.latlng.lat,t.latlng.lng]))}));const m={onAddObject:{flyTo:!0},resetToDefault:function(){this.onAddObject={flyTo:!0}}},g={markerPin:{point:!0,circle:!0,polyline:!0,polygon:!0,rectangle:!0},markerDot:{point:!0,circle:!0,polyline:!0,polygon:!0,rectangle:!0},color:{point:"#6e14ef",circle:"#3388ff",polyline:"#ff3333",polygon:"#008000",rectangle:"#801900"},lineWeight:{point:null,circle:2,polyline:2,polygon:2,rectangle:2},resetToDefault:function(){this.markerPin={point:!0,circle:!0,polyline:!0,polygon:!0,rectangle:!0},this.markerDot={point:!0,circle:!0,polyline:!0,polygon:!0,rectangle:!0},this.color={point:"#6e14ef",circle:"#3388ff",polyline:"#ff3333",polygon:"#008000",rectangle:"#801900"},this.lineWeight={point:null,circle:2,polyline:2,polygon:2,rectangle:2}}},y=document.querySelectorAll('[class^="b-map-setting-"]'),f=document.querySelectorAll('[class^="b-obj-setting-"]');function h(t){let e=null;return t.className.startsWith("b-obj-setting-")&&(e=t.className.replace("b-obj-setting-","").split("-")),t.className.startsWith("b-map-setting-")&&(e=t.className.replace("b-map-setting-","").split("-")),{parameter:e[0],type:e[1]}}function b(){y.forEach((t=>{let e=h(t);m[e.parameter][e.type]?t.checked=!0:t.checked=!1})),f.forEach((t=>{let e=h(t);e.parameter.startsWith("marker")?g[e.parameter][e.type]?t.checked=!0:t.checked=!1:t.value=g[e.parameter][e.type],"lineWeight"===e.parameter&&(t.parentNode.getElementsByTagName("label")[0].textContent=g[e.parameter][e.type]+"px")}))}y.forEach((t=>{let e=h(t);t.addEventListener("change",(function(){m[e.parameter][e.type]=this.checked,localStorage.setItem(`${e.parameter}Settings`,JSON.stringify(m[e.parameter]))}))})),f.forEach((t=>{let e=h(t);t.addEventListener("change",(function(){let t=e.parameter.startsWith("marker")?this.checked:this.value;"lineWeight"===e.parameter&&(this.parentNode.getElementsByTagName("label")[0].textContent=t+"px"),g[e.parameter][e.type]=t,localStorage.setItem(`${e.parameter}Settings`,JSON.stringify(g[e.parameter]))}))}));let v=[];function k(t,e,o){let n=[],a=null;function l(){let e=n.shift();e&&t.apply(e.context,e.arguments),0===n.length&&(clearInterval(a),a=null)}return function(){n.push({context:o||this,arguments:[].slice.call(arguments)}),a||(a=setInterval(l,e))}}let w=k((function(t,e){v.filter((e=>e.lat===t)).find((t=>t.lon===e))||fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${t}&lon=${e}`).then((function(t){return t.json()})).then((function(o){let n={lat:t,lon:e,address:o.display_name};v.push(n)}))}),1100),S=k((function(t,e){let o=e.findIndex((e=>e.id===t));o>=0&&e[o].leaflet_object.getLayers().filter((t=>t instanceof L.Marker)).forEach((t=>{let e=t.options.latLon[0],o=t.options.latLon[1],n=v.filter((t=>t.lat===e)).find((t=>t.lon===o)).address;if(n){let e=t.getPopup().getContent(),o=`<div class="popup-row"><div class="popup-col-1">Address:</div><div class="popup-col-2"><small>${n}</small></div></div>`;t.getPopup().setContent(e+o)}}))}),5500);function M(t,e){return`<div class='b-marker-icon-arrow' style='background-color: transparent; transform: rotate(${e}deg)'><?xml version="1.0" encoding="UTF-8"?><svg class="b-marker-icon-arrow__shadow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="24" height="24" viewBox="0 0 24 24">\n<path stroke="white" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" fill="${t}" d="M12,2L4.5,20.29L5.21,21L12,18L18.79,21L19.5,20.29L12,2Z" />\n</svg></div>`}function T(t,e,o=1,n=1,a,l,r){let i="";if(r)for(const[t,e]of Object.entries(r))i+=`${H(e)} ${t}<br>`;else i="—";return`<div class="popup-row"><div class="popup-col-1">ID:</div><div class="popup-col-2">${t}</div></div><div class="popup-row"><div class="popup-col-1">Type:</div><div class="popup-col-2">${e}</div></div><div class="popup-row"><div class="popup-col-1">Points:</div><div class="popup-col-2">${o} / ${n}</div></div><div class="popup-row"><div class="popup-col-1">Lat, Lon:</div><div class="popup-col-2"><strong>${a}, ${l}</strong></div></div><div class="popup-row"><div class="popup-col-1">Meas’s.:</div><div class="popup-col-2">${i}</div></div>`}window.mdc.autoInit();let x=new mdc.snackbar.MDCSnackbar(document.getElementById("b-mdc-snackbar")),j=document.getElementById("b-mdc-snackbar-content");x.timeoutMs=7500;const E=t=>{"addArray"===t.type?j.innerHTML=`Added <strong>${t.payload.points}</strong> point(s), <strong>${t.payload.circles}</strong> circle(s), <strong>${t.payload.polylines}</strong> polyline(s), <strong>${t.payload.polygones}</strong> polygone(s) and <strong>${t.payload.rectangles}</strong> rectangle(s).<br>Skipped <strong>${t.payload.skipped}</strong> element(s).`:j.innerHTML=t.text};let O=new mdc.tabBar.MDCTabBar(document.querySelector(".mdc-tab-bar")),A=document.querySelectorAll(".mdc-tab-content"),$=["point","circle","line","array"],C="point",N=document.getElementById("hint-about-tabs");O.listen("MDCTabBar:activated",(function(t){var e;C=$[t.detail.index],document.querySelector(".mdc-tab-content--active").classList.remove("mdc-tab-content--active"),A[t.detail.index].classList.add("mdc-tab-content--active"),history.pushState("","","?tab="+C),N.innerHTML="point"===(e=C)?"<p>You can add point by holding down the <kbd>shift</kbd> key while left-clicking on the map.</p><p>Click once to add one point.</p>":"circle"===e?"<p>You can add circle by holding down the <kbd>shift</kbd> key while left-clicking on the map.</p><p>Click twice — first time to add center point and second for circle edge.</p>":"line"===e?"<p>You can add line, polyline or polygon by holding down the <kbd>shift</kbd> key while left-clicking on the map.</p><p>Click on any temp marker to finish. If you click first marker at last it will be polygon, otherwise it will be polyline.</p>":"array"===e?'<p>Array of objects: <code>[{obj_1}, {obj_2}, ..., {obj_n}]</code>.<a href="https://github.com/bazhanius/simple-geo-tool/#json-format">Learn more</a>.</p>':""}));const P=()=>C,B=document.querySelector("#b-mdc-modal-window"),_=new mdc.dialog.MDCDialog(B);B.querySelector("#dialog-confirm").onclick=function(){J("https://yandex.com/support/common/browsers-settings/"),_.close()},B.querySelector("#dialog-cancel").onclick=function(){_.close()};const I=new mdc.dialog.MDCDialog(document.querySelector("#b-mdc-modal-window-object-info")),D=document.querySelector("#b-object-info-dialog-title"),q=document.querySelector("#b-object-info-dialog-content"),z=new mdc.dialog.MDCDialog(document.querySelector("#b-mdc-modal-window-settings")),W=(t,e)=>{let o=t.length,n={m2:0,km2:0,ft2:0,mi2:0,ac:0},a=o-1;for(let e=0;e<o;e++){let o=111319.5*t[a][0],l=111319.5*t[e][0],r=t[a][1]*(40075e3*Math.cos(t[a][0]*Math.PI/180)/360),i=t[e][1]*(40075e3*Math.cos(t[e][0]*Math.PI/180)/360);n.m2=n.m2+(o+l)*(r-i),a=e}return n.m2=Math.round(100*Math.abs(n.m2/2))/100,n.km2=Math.round(n.m2/1e6*100)/100,n.ft2=Math.round(10.76391*n.m2*100)/100,n.mi2=Math.round(3.8610216e-7*n.m2*100)/100,n.ac=Math.round(24711e-8*n.m2*100)/100,e in n?n[e]:n},F=(t,e)=>{navigator.clipboard.writeText(t).then((function(){E({type:"clipboardCopyResult",text:`JSON data of <b>${e}</b> copied to clipboard successfully!`}),x.close(),x.open()}),(function(){E({type:"clipboardCopyResult",text:`JSON data of <b>${e}</b> copying to clipboard failed!`}),x.close(),x.open()}))},J=t=>{window.open(t,"_blank").focus()},H=t=>void 0===t?"—":t.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),R=(t,e)=>{let o={m:parseFloat(t).toFixed(0),km:(parseFloat(t)/1e3).toFixed(2)};return e in o?o[e]:o},U=t=>!isNaN(t)&&""!==t&&Math.abs(t)<=90,G=t=>!isNaN(t)&&""!==t&&Math.abs(t)<=180,V=t=>{if(t.length<5||!t.startsWith("["))return!1;try{return JSON.parse(t)}catch(t){return!1}},Z=function(){let t=document.querySelector("#point-lat"),e=document.querySelector("#point-lon"),o=document.querySelector("#circle-lat"),n=document.querySelector("#circle-lon"),a=document.querySelector("#circle-radius"),l=document.querySelector("#line-lat-1"),r=document.querySelector("#line-lon-1"),i=document.querySelector("#line-lat-2"),c=document.querySelector("#line-lon-2"),s=document.querySelector("#array-of-coordinates");return{getNodeList:function(d){return"point"===d?[t,e]:"circle"===d?[o,n,a]:"line"===d?[l,r,i,c]:"array"===d?[s]:[]},getValues:function(d){return"point"===d?{lat:t.value,lon:e.value}:"circle"===d?{lat:o.value,lon:n.value,rad:a.value}:"line"===d?{latOne:l.value,lonOne:r.value,latTwo:i.value,lonTwo:c.value}:"array"===d?{arrayList:s.value}:{}},clearValues:function(d){"point"===d?(t.value="",e.value=""):"circle"===d?(o.value="",n.value="",a.value=""):"line"===d?(l.value="",r.value="",i.value="",c.value=""):"array"===d&&(s.value="")},validateValues:function(t){if("point"===t){let t=[0,0,0],e=Z.getValues("point");return U(e.lat)?t[0]=1:t[0]=0,G(e.lon)?t[1]=1:t[1]=0,e.lat||e.lon?t[2]=1:t[2]=0,t}if("circle"===t){let t=[0,0,0,0],e=Z.getValues("circle");return U(e.lat)?t[0]=1:t[0]=0,G(e.lon)?t[1]=1:t[1]=0,e.rad&&!isNaN(e.rad)&&e.rad>0&&e.rad<=1e6?t[2]=1:t[2]=0,e.lat||e.lon||e.rad?t[3]=1:t[3]=0,t}if("line"===t){let t=[0,0,0,0,0],e=Z.getValues("line");return U(e.latOne)?t[0]=1:t[0]=0,G(e.lonOne)?t[1]=1:t[1]=0,U(e.latTwo)?t[2]=1:t[2]=0,G(e.lonTwo)?t[3]=1:t[3]=0,e.latOne||e.lonOne||e.latTwo||e.lonTwo?t[4]=1:t[4]=0,t}if("array"===t){let t=[0,0,0],e=Z.getValues("array"),o=new RegExp(/^[0-9a-z\ \s*\#\(\)\.\,\-\[\]\{\}\"\:]*$/i);return e.arrayList&&o.test(e.arrayList)?t[0]=1:t[0]=0,e.arrayList?t[1]=1:t[1]=0,V(e.arrayList)?t[2]=1:t[2]=0,t}return[]}}}();Z.getNodeList("point").forEach((function(t){t.addEventListener("keyup",(function(){Y.toggleAddToMapButtons("point")}))})),Z.getNodeList("circle").forEach((function(t){t.addEventListener("keyup",(function(){Y.toggleAddToMapButtons("circle")}))})),Z.getNodeList("line").forEach((function(t){t.addEventListener("keyup",(function(){Y.toggleAddToMapButtons("line")}))})),Z.getNodeList("array").forEach((function(t){t.addEventListener("keyup",(function(){Y.toggleAddToMapButtons("array")}))}));const Y=function(){let t=document.querySelector("#button-add-to-map"),e=document.querySelector("#button-clear-fields"),o=document.querySelector("#button-settings"),n=document.querySelector("#button-settings-reset"),a=document.querySelector("#button-objects-copy-all"),l=document.querySelector("#button-objects-zoom-all"),r=document.querySelector("#button-objects-delete-all");return{applyClickEvents:function(){t.addEventListener("click",(function(){let t,e,o=P(),n=Z.getValues(o);"point"===o?t=jt.add({type:"point",coords:[{lat:n.lat,lon:n.lon}]}):"circle"===o?t=jt.add({type:"circle",coords:[{lat:n.lat,lon:n.lon}],radius:n.rad}):"line"===o?t=jt.add({type:"polyline",coords:[{lat:n.latOne,lon:n.lonOne},{lat:n.latTwo,lon:n.lonTwo}]}):"array"===o&&(e=jt.addArray(n.arrayList)),"array"!==o?m.onAddObject.flyTo&&jt.locateByObjectID(t):(e.payload.points+e.payload.circles+e.payload.polylines+e.payload.polygones>0&&m.onAddObject.flyTo&&jt.showAll(),E(e),x.close(),x.open())})),e.addEventListener("click",(function(){let t=P();Z.clearValues(t),Y.toggleAddToMapButtons(t)})),o.addEventListener("click",(function(){z.open()})),n.addEventListener("click",(function(){g.resetToDefault(),m.resetToDefault(),localStorage.clear(),E({type:"fullReset",text:"<b>LocalStorage</b> is cleared and <b>Settings</b> was restored to their defaults!"}),x.close(),x.open(),b()})),a.addEventListener("click",(function(){jt.copyAllToClipboard()})),l.addEventListener("click",(function(){jt.showAll()})),r.addEventListener("click",(function(){jt.deleteAll()}))},updateObjectsManagementButtons:function(){let t=document.querySelectorAll(".button-object-info"),e=document.querySelectorAll(".button-object-copy"),o=document.querySelectorAll(".button-object-locate"),n=document.querySelectorAll(".button-object-delete");t.forEach((function(t){t.addEventListener("click",(function(){let t=function(t){let e={title:'<i class="mdi mdi-information mdi-18px"></i> Object info',content:""};e.content+='<table class="b-obj-info-table"><tbody><tr>',e.content+=`<tr><td>ID</td><td><b class="b-obj-info-bold-mono">${t.id}</b></td></tr>`,e.content+=`<tr><td>Type</td><td><b class="b-obj-info-bold-mono">${t.type}</b></td></tr>`,e.content+=`<td>JSON</td><td><pre class="b-obj-info-pre">${JSON.stringify(t.object,void 0,2)}</pre></td></tr>`;let o=t.object.coords,n="";o.forEach(((t,e)=>{n+=`${e+1}: <b class="b-obj-info-bold-mono">${t.lat} ${t.lon}</b><br>`})),e.content+=`<tr><td>Coordinates</td><td><pre class="b-obj-info-pre">${n}</td></pre></td></tr>`;let a={point:!1,circle:"radius",polyline:"distance",polygon:"area",rectangle:"area"},l="";for(const[e,o]of Object.entries(t.measurements))l+=`${H(o)} ${e.replace("2","<sup>2</sup>")}<br>`;return e.content+=`<tr><td>Measurements${a[t.type]?'<br><span class="b-obj-info-regular-sans">('+a[t.type]+")</span>":""}</td><td>${""!==l?l:"—"}</td></tr>`,t.azimuth&&(e.content+=`<tr><td>Azimuth</td><td>${t.azimuth}°</td></tr>`),e.content+=`<tr><td>Color</td><td><span class="b-obj-info-dot"  style="background-color:${t.color}"></span>${t.color}</td></tr>`,e.content+=`<tr><td>Line weight</td><td>${t.weight?t.weight+"px":"—"}</td></tr>`,e.content+=`<tr><td>Show marker dot</td><td>${t.show_marker_dot}</td></tr>`,e.content+=`<tr><td>Show marker pin</td><td>${t.show_marker_pin}</td></tr>`,e.content+="</tbody></table>",e}(jt.getFullInfo(this));var e,o;e=t.title,o=t.content,D.innerHTML=e,q.innerHTML=o,I.open()}))})),e.forEach((function(t){t.addEventListener("click",(function(){jt.copyToClipboardByNode(this)}))})),o.forEach((function(t){t.addEventListener("click",(function(){jt.locateByNode(this)}))})),n.forEach((function(t){t.addEventListener("click",(function(){jt.delete(this),Y.toggleObjectListButton()}))}))},toggleAddToMapButtons:function(o){let n=Z.validateValues(o);t.disabled=n.indexOf(0)>-1,e.disabled=n.indexOf(1)<=-1},toggleObjectListButton:function(){let t=document.querySelector("#objects-list");Tt.length>0?(a.disabled=!1,l.disabled=!1,r.disabled=!1,t.style.visibility="visible"):(a.disabled=!0,l.disabled=!0,r.disabled=!0,t.style.visibility="hidden")}}}();document.querySelectorAll(".mdc-tab").forEach((function(t){t.addEventListener("click",(function(){let t=this.getAttribute("data-tab-name");Y.toggleAddToMapButtons(t),at=[],lt.clearLayers(),tt&&(tt.remove(),tt=void 0),et&&(et.remove(),et=void 0),X&&(X.remove(),X=void 0),Q&&(Q.remove(),Q=void 0)}))}));const K=L.Control.extend({onAdd:t=>{const e=L.DomUtil.create("div");return e.innerHTML='<div class="mouse-cursor-helper"><p id="mouse-coordinates">0, 0</p><p id="temp-object-summary"></p></div>',e}});p.addControl(new K({position:"topright"}));let X,Q,tt,et,ot=document.querySelector("#mouse-coordinates"),nt=document.querySelector("#temp-object-summary"),at=[],lt=(new L.featureGroup).addTo(p),rt=L.divIcon({className:"marker-icon-pin",html:"<div class='marker-pin marker-point-temp-color'></div><b>+</b>",iconSize:[30,42],iconAnchor:[15,42]}),it=L.divIcon({className:"marker-icon-dot marker-point-temp-color",iconSize:[4,4],iconAnchor:[3,3]}),ct=!1;function st(t){ct=t.shiftKey,ct?L.DomUtil.addClass(p._container,"crosshair-cursor-enabled"):L.DomUtil.removeClass(p._container,"crosshair-cursor-enabled")}window.addEventListener("keydown",st,!1),window.addEventListener("keypress",st,!1),window.addEventListener("keyup",st,!1);const dt=t=>{let e=at[0].lat===t[0]&&at[0].lon===t[1]&&at.length>2?"polygon":"polyline";jt.add({type:e,coords:at}),lt.clearLayers(),at=[],X.remove(),Q.remove(),et.remove(),et=void 0};p.on("click",(function(t){if(ct&&"array"!==C){let e=P();if(at.push({lat:parseFloat(t.latlng.lat).toFixed(6),lon:parseFloat(t.latlng.lng).toFixed(6)}),"point"===e&&ct&&(jt.add({type:"point",coords:at}),at=[]),"circle"===e&&ct&&(1===at.length?(tt=L.circle([at[0].lat,at[0].lon],{radius:0,weight:2,color:"#ff3",opacity:.8,fillOpacity:.1}).addTo(p),lt.addLayer(L.marker([at[0].lat,at[0].lon],{icon:rt})),lt.addLayer(L.marker([at[0].lat,at[0].lon],{icon:it}))):at.length>=2&&(jt.add({type:"circle",radius:parseFloat(L.latLng([at[0].lat,at[0].lon]).distanceTo([at[1].lat,at[1].lon])).toFixed(0),coords:at.splice(0,1)}),lt.clearLayers(),at=[],tt.remove())),"line"===e&&ct){let t=at.length-1;et?et.setLatLngs(at):et=L.polyline(at,{color:"#ff3",weight:2,opacity:.6}).addTo(p),lt.addLayer(L.marker([at[t].lat,at[t].lon],{icon:rt}).on("click",(()=>{dt([at[t].lat,at[t].lon])}))),lt.addLayer(L.marker([at[t].lat,at[t].lon],{icon:it}).on("click",(e=>{dt([at[t].lat,at[t].lon])}))),X?X.setLatLng([at[t].lat,at[t].lon]):X=L.marker([at[t].lat,at[t].lon],{icon:rt}).addTo(p),Q?Q.setLatLng([at[t].lat,at[t].lon]):Q=L.marker([at[t].lat,at[t].lon],{icon:it}).addTo(p)}}})),p.on("mousemove",(t=>{let e=parseFloat(t.latlng.lat).toFixed(6),o=parseFloat(t.latlng.lng).toFixed(6);if(!at[0]&&ct&&et&&"array"!==C&&(X.setLatLng([e,o]),Q.setLatLng([e,o])),at[0]){let t=L.latLng([at[0].lat,at[0].lon]).distanceTo([e,o]).toFixed(0);ot.innerHTML=`<span class="mdi mdi-map-marker mdi-12px"></span> ${at[0].lat}, ${at[0].lon}`,nt.innerHTML=`<span class="mdi mdi-crosshairs mdi-12px"></span> ${e}, ${o}`,nt.innerHTML+=`<br>${H(t)} m`,tt&&tt.setRadius(t),et&&(X.setLatLng([e,o]),Q.setLatLng([e,o]),et.setLatLngs(at.concat({lat:e,lon:o})))}else ot.innerHTML=`<span class="mdi mdi-crosshairs mdi-12px"></span> ${e}, ${o}`,nt.innerHTML=""}));const pt=L.Control.extend({onAdd:t=>{const e=L.DomUtil.create("div");return L.DomEvent.disableClickPropagation(e),e.innerHTML='<div class="ruler-control"><div class="ruler-control-polyline mdi mdi-ruler mdi-18px" title="Ruler"></div></div>',e}});p.addControl(new pt({position:"topleft"})),p.createPane("rulerLinesPane"),p.getPane("rulerLinesPane").style.zIndex=650,p.createPane("rulerMarkersPane"),p.getPane("rulerMarkersPane").style.zIndex=651;const ut=document.querySelector(".ruler-control-polyline");let mt=!1,gt=(new L.featureGroup).addTo(p),yt=[],ft=null;const ht=()=>{gt.addLayer(L.polyline([],{className:"ruler-polyline-path-bg",pane:"rulerLinesPane"}).addTo(p)),gt.addLayer(L.polyline([],{className:"ruler-polyline-path",pane:"rulerLinesPane"}).addTo(p))};function bt(){gt.eachLayer((function(t){t instanceof L.Marker&&t.closePopup()}))}function Lt(){kt()}function vt(){kt(),St(ft._leaflet_id)}ht(),ut.addEventListener("click",(function(){!1===mt?(ut.classList.add("ruler-control__active"),L.DomUtil.addClass(p._container,"crosshair-cursor-enabled"),mt=!0,jt.disableAllPopups()):(ut.classList.remove("ruler-control__active"),L.DomUtil.removeClass(p._container,"crosshair-cursor-enabled"),mt=!1,gt.clearLayers(),ht(),yt=[],jt.enableAllPopups())}));const kt=(t,e)=>{if(t&&e){let o=L.divIcon({className:"marker-icon-pin",html:"<div class='ruler-marker-pin'></div>",iconSize:[15,15],iconAnchor:[0,0]}),n=L.marker([t,e],{icon:o,draggable:!0,pane:"rulerMarkersPane"}).on("dragstart",bt).on("drag",Lt).on("dragend",vt).on("popupopen",(t=>{St(t.popup._source._leaflet_id)})).addTo(p);gt.addLayer(n)}yt=(t=>{let e=[];return t.eachLayer((function(t){t instanceof L.Marker&&e.push(t.getLatLng())})),[e]})(gt),gt.eachLayer((function(t){t instanceof L.Polyline&&t.setLatLngs(yt)})),wt()},wt=()=>{let t=0,e=null;gt.eachLayer((function(o){if(o instanceof L.Marker){let n=o.getLatLng();e&&(t+=e.distanceTo(n)),e=n;let a=function(t,e){let o=R(t),n={};return n=o.m<1e4?{value:o.m,unit:"m"}:{value:o.km,unit:"km"},`<strong>${H(n.value)} ${n.unit}</strong><span id="ruler-id-${e}" class="mdi mdi-icon-button mdi-delete-forever mdi-12px"></span>`}(t,o._leaflet_id),l=o.getPopup();l?l.setContent(a):o.bindPopup(a,{className:"ruler-marker-pin-popup",offset:[0,-12],minWidth:20,closeButton:!1,autoClose:!1}).addTo(p),ft=o}})),ft&&ft.openPopup()},St=t=>{let e=document.querySelector("#ruler-id-"+t);e&&e.addEventListener("click",(function(){gt.removeLayer(t),kt()}))};p.on("click",(function(t){mt&&!ct&&kt(t.latlng.lat,t.latlng.lng)}));let Mt=0,Tt=[],xt=document.querySelector("#objects-list > tbody");const jt={add:function(t){try{Mt++;let e,o=t.type,n=t.coords,a=[],l=t.radius?t.radius:null,r="",i=t.color||g.color[o],c=t.weight>=0?t.weight:g.lineWeight[o],s=!1!==t.showMarkerPin&&g.markerPin[o],d=!1!==t.showMarkerDot&&g.markerDot[o],u=t.azimuth,m={pin:L.divIcon({className:"b-marker-icon",html:`<div class='b-marker-icon-pin' style='background-color:${i}'></div><b class='b-marker-icon-pin__content'>${Mt}</b>`,iconSize:[30,42],iconAnchor:[15,42]}),dot:L.divIcon({className:"b-marker-icon",html:`<div class='b-marker-icon-dot' style='background-color:${i}'></div>`,iconSize:[4,4],iconAnchor:[5,5]}),arrow:L.divIcon({className:"b-marker-icon",html:M(i,u),iconSize:[24,24],iconAnchor:[12,12]})};if("point"===o){let t=n[0].lat,e=n[0].lon;a.push(L.marker([t,e],{id:Mt,points:[1,1],latLon:[t,e],icon:u>=0&&u<=360?m.arrow:m.dot}).bindPopup(T(Mt,"Point",1,1,t,e))),s&&a.push(L.marker([t,e],{id:Mt,points:[1,1],latLon:[t,e],icon:m.pin}).bindPopup(T(Mt,"Point",1,1,t,e))),w(t,e)}if("circle"===o){r=R(l);let t=n[0].lat,e=n[0].lon;a.push(L.circle([t,e],{radius:l,color:i,weight:c})),d&&a.push(L.marker([t,e],{id:Mt,points:[1,1],latLon:[t,e],radius:l,icon:u>=0&&u<=360?m.arrow:m.dot}).bindPopup(T(Mt,"Circle",1,1,t,e,r))),s&&a.push(L.marker([t,e],{id:Mt,points:[1,1],latLon:[t,e],radius:l,icon:m.pin}).bindPopup(T(Mt,"Circle",1,1,t,e,r))),w(t,e)}if("polyline"===o){let t=n.length,e=[];n.forEach(((o,n)=>{let l=o.lat,r=o.lon;e.push([l,r]),d&&a.push(L.marker([l,r],{id:Mt,points:[n+1,t],latLon:[l,r],icon:m.dot}).bindPopup(T(Mt,"Polyline",n+1,t,l,r))),s&&a.push(L.marker([l,r],{id:Mt,points:[n+1,t],latLon:[l,r],icon:m.pin}).bindPopup(T(Mt,"Polyline",n+1,t,l,r))),w(l,r)})),r=((t,e)=>{let o={m:0,km:0},n=null;return t.forEach(((t,e)=>{let a=t[0],l=t[1];n&&(o.m+=L.latLng(n).distanceTo([a,l])),n=[a,l]})),o.km=Math.round(o.m/1e3*100)/100,o.m=Math.round(100*o.m)/100,e in o?o[e]:o})(e),a.push(L.polyline(e,{color:i,weight:c}))}if("polygon"===o){let t=n.length,e=[];n.forEach(((o,n)=>{let l=o.lat,r=o.lon;e.push([l,r]),d&&a.push(L.marker([l,r],{id:Mt,points:[n+1,t],latLon:[l,r],icon:m.dot}).bindPopup(T(Mt,"Polygon",n+1,t,l,r))),s&&a.push(L.marker([l,r],{id:Mt,points:[n+1,t],latLon:[l,r],icon:m.pin}).bindPopup(T(Mt,"Polygon",n+1,t,l,r))),w(l,r)})),r=W(e),a.push(L.polygon(e,{color:i,weight:c}))}if("rectangle"===o){let t=[[n[0].lat,n[0].lon],[n[1].lat,n[1].lon]];t.forEach(((t,e)=>{let o=t[0],n=t[1];d&&a.push(L.marker([o,n],{id:Mt,points:[e+1,2],latLon:[o,n],icon:m.dot}).bindPopup(T(Mt,"Rectangle",e+1,2,o,n))),s&&a.push(L.marker([o,n],{id:Mt,points:[e+1,2],latLon:[o,n],icon:m.pin}).bindPopup(T(Mt,"Rectangle",e+1,2,o,n))),w(o,n)})),r=W([[n[0].lat,n[0].lon],[n[0].lat,n[1].lon],[n[1].lat,n[1].lon],[n[1].lat,n[0].lon]]),a.push(L.rectangle(t,{color:i,weight:c}))}e=new L.featureGroup(a).addTo(p);let y={id:Mt,type:o,object:t,leaflet_object:e,measurements:r,color:i,weight:c,show_marker_dot:d,show_marker_pin:s,azimuth:u};return Tt.push(y),xt.innerHTML+=function(t){let e="",o="—";return t.azimuth&&(o=t.azimuth+"°"),"polyline"!==t.type&&"circle"!==t.type||(e=t.measurements.m>1e4?`${H(t.measurements.km)} km`:`${H(t.measurements.m)} m`),"polygon"!==t.type&&"rectangle"!==t.type||(e=t.measurements.m2>1e4?`${H(t.measurements.km2)} km<sup>2</sup>`:`${H(t.measurements.m2)} m<sup>2</sup>`),"—"!==o?o+=", "+e:o=e,`<tr><td>${t.id}</td><td>${t.type}</td><td>${o}</td><td><button class="mdc-button button-object-info" title="Full info"><span class="mdc-button__ripple"></span><span class="mdi mdi-icon-button mdi-information-outline mdi-18px"></span></button><button class="mdc-button button-object-copy" title="Copy JSON to clipboard"><span class="mdc-button__ripple"></span><span class="mdi mdi-icon-button mdi-content-copy mdi-18px"></span></button><button class="mdc-button button-object-locate" title="Locate on the map"><span class="mdc-button__ripple"></span><span class="mdi mdi-icon-button mdi-crosshairs-gps mdi-18px"></span></button><button class="mdc-button button-object-delete"  title="Delete object"><span class="mdc-button__ripple"></span><span class="mdi mdi-icon-button mdi-delete-forever mdi-18px"></span></button></td></tr>`}(y),Y.updateObjectsManagementButtons(),Y.toggleObjectListButton(),S(Mt,Tt),mt&&jt.disableAllPopups(),Mt}catch(t){return console.log(t),Mt--,-1}},addArray:function(t){let e={type:"addArray",payload:{points:0,circles:0,polylines:0,polygones:0,rectangles:0,skipped:0}};return JSON.parse(t).forEach(((t,o)=>{let n=t;if("group"===t.type){let e=null,o=jt.getBoundsByObjectIDs(t.objectIDs);-1!==o&&("drawCircleBounds"===t.function&&(e={type:"circle",radius:o.radius,coords:[{lat:o.center.lat,lon:o.center.lng}]}),"drawRectangleBounds"===t.function&&(e={type:"rectangle",coords:[{lat:o.southEast.lat,lon:o.southEast.lng},{lat:o.northWest.lat,lon:o.northWest.lng}]}),null!==e&&(t.color&&(e.color=t.color),t.weight>=0&&(e.weight=t.weight),!0===t.showMarkerDot?e.showMarkerDot=!0:!1===t.showMarkerDot&&(e.showMarkerDot=!1),!0===t.showMarkerPin?e.showMarkerPin=!0:!1===t.showMarkerPin&&(e.showMarkerPin=!1),n=e))}n.type&&n.coords&&jt.add(n)>0?"point"===n.type?e.payload.points+=1:"circle"===n.type?e.payload.circles+=1:"polyline"===n.type?e.payload.polylines+=1:"polygon"===n.type?e.payload.polygones+=1:"rectangle"===n.type&&(e.payload.rectangles+=1):e.payload.skipped+=1})),e},delete:function(t){let e=t.parentNode.parentNode,o=parseInt(e.firstChild.textContent),n=Tt.findIndex((t=>t.id===o));Tt[n].leaflet_object.clearLayers(),Tt.splice(n,1),e.remove()},copyAllToClipboard:function(){let t=[];Tt.forEach((function(e){t.push(e.object)})),F(JSON.stringify(t),"all objects")},copyToClipboardByNode:function(t){let e=t.parentNode.parentNode,o=parseInt(e.firstChild.textContent),n=Tt.findIndex((t=>t.id===o));F("["+JSON.stringify(Tt[n].object)+"]",Tt[n].type)},locateByNode:function(t){let e=t.parentNode.parentNode,o=parseInt(e.firstChild.textContent),n=Tt.findIndex((t=>t.id===o));p.flyToBounds(Tt[n].leaflet_object.getBounds(),{padding:L.point(100,100)})},locateByObjectID:function(t){let e=Tt.findIndex((e=>e.id===t));"point"===Tt[e].type?p.flyToBounds(Tt[e].leaflet_object.getBounds(),{maxZoom:12}):p.flyToBounds(Tt[e].leaflet_object.getBounds(),{padding:L.point(100,100)})},getBoundsByObjectIDs:function(t){try{let e=[];t.forEach((function(t){let o=Tt.findIndex((e=>e.id===t));-1!==o&&e.push(Tt[o].leaflet_object)}));let o=new L.featureGroup(e),n=o.getBounds().getCenter(),a=o.getBounds().getNorthWest(),l=o.getBounds().getSouthEast(),r=o.getBounds().getNorthEast(),i=o.getBounds().getSouthWest(),c=L.latLng(r).distanceTo(a),s=L.latLng(l).distanceTo(i),d=L.latLng(r).distanceTo(l),p=L.latLng(a).distanceTo(i);return{center:n,radius:Math.max(c,s,d,p)/Math.sqrt(3),northWest:a,southEast:l}}catch(t){return console.log(t),-1}},deleteAll:function(){Tt.forEach((function(t){t.leaflet_object.clearLayers()})),Tt=[],xt.innerHTML="",Y.toggleObjectListButton()},showAll:function(){let t=[];if(Tt.forEach((function(e){t.push(e.leaflet_object)})),t.length){let e=new L.featureGroup(t);p.flyToBounds(e.getBounds(),{padding:L.point(30,30)})}},disableAllPopups:function(){Tt.forEach((function(t){t.leaflet_object.eachLayer((function(t){t instanceof L.Marker&&t.off("click")}))}))},enableAllPopups:function(){Tt.forEach((function(t){t.leaflet_object.eachLayer((function(t){t instanceof L.Marker&&t.on("click",(function(){t.getPopup()&&t.openPopup()}))}))}))},getFullInfo:function(t){let e=t.parentNode.parentNode,o=parseInt(e.firstChild.textContent),n=Tt.findIndex((t=>t.id===o));return Tt[n]}},Et=L.Control.extend({onAdd:t=>{const e=L.DomUtil.create("div");return L.DomEvent.disableClickPropagation(e),e.innerHTML='<div class="user-location-control"><span class="mdi mdi-near-me mdi-18px" title="My location"></span></div>',e}});p.addControl(new Et({position:"topleft"}));const Ot=document.querySelector(".user-location-control"),At=Ot.getElementsByTagName("SPAN")[0];Ot.addEventListener("click",(function(){$t()}));const $t=()=>{At.classList.remove("mdi-near-me"),At.classList.add("mdi-loading","mdi-spin");let t=[];navigator.geolocation.getCurrentPosition((function(e){t=[e.coords.latitude,e.coords.longitude,e.coords.accuracy],p.setView([t[0],t[1]],10);let o=jt.add({type:"circle",coords:[{lat:t[0],lon:t[1]}],radius:t[2]});jt.locateByObjectID(o),At.classList.remove("mdi-loading","mdi-spin"),At.classList.add("mdi-near-me")}),(function(t){console.warn(`ERROR(${t.code}): ${t.message}`),At.classList.remove("mdi-loading","mdi-spin"),At.classList.add("mdi-near-me"),_.open()}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})};document.addEventListener("DOMContentLoaded",(function(){Y.applyClickEvents(),Y.toggleAddToMapButtons(P()),Y.toggleObjectListButton(),(()=>{let t=new URLSearchParams(location.search),e=t.get("tab"),o=t.get("addArray");if("point"===e)O.activateTab(0),C="point";else if("circle"===e)O.activateTab(1),C="circle";else if("line"===e)O.activateTab(2),C="line";else if("array"===e){if(O.activateTab(3),C="array",o&&V(o)){let t=jt.addArray(o);t.payload.points+t.payload.circles+t.payload.polylines+t.payload.polygones>0&&jt.showAll(),E(t),x.close(),x.open()}}else history.pushState({},null,location.href.split("?")[0])})(),function(){let t=JSON.parse(localStorage.getItem("onAddObjectSettings")),e=JSON.parse(localStorage.getItem("markerPinSettings")),o=JSON.parse(localStorage.getItem("markerDotSettings")),n=JSON.parse(localStorage.getItem("colorSettings")),a=JSON.parse(localStorage.getItem("lineWeightSettings"));t&&(m.onAddObject=t),e&&(g.markerPin=e),o&&(g.markerDot=o),n&&(g.color=n),a&&(g.lineWeight=a)}(),b()}))})();